{% extends 'base.html' %}

{% block title %}Clientes{% endblock %}

{% block head %}
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="/static/css/firewall-backup.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container {% if not clients or clients|length == 0 %}is-empty{% endif %}">
    <form id="clients-form" autocomplete="off">
        <div class="client-list" id="client-list" data-next-id="{{ (clients|length) if clients is defined else 0 }}">
            {% if clients and clients|length > 0 %}
            {% for c in clients %}
            <div class="client-item" data-id="{{ c.id }}">
                <div class="item-row">
                    <div class="item-display" title="{{ c.name }}">{{ c.name }}</div>
                    <button type="button" class="square-button" title="Edit client" data-action="edit">
                        <span class="material-symbols-outlined">edit</span>
                    </button>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="empty-card">
                <p>No clients found.</p>
                <button type="button" id="add-client" class="btn-link only-icon" title="Add client">
                    <span class="material-symbols-outlined">add</span>
                </button>
            </div>
            {% endif %}
        </div>
    </form>
</div>
<div class="modal-overlay" id="add-modal" hidden>
    <div class="modal">
        <div class="modal-card">
            <form id="add-client-form" class="modal-body" autocomplete="off">
                <!-- Platform segmented control -->
                <div class="fb-group">
                    <label>PLATAFORMA</label>
                    <div class="platform-segment" id="platform-segment" role="tablist" aria-label="Platform">
                        <button type="button" class="platform-option is-active" data-platform="opnsense" role="tab"
                            aria-selected="true">OPNsense</button>
                        <button type="button" class="platform-option" data-platform="pfsense" role="tab"
                            aria-selected="false">pfSense</button>
                    </div>
                    <input type="hidden" id="platform" value="opnsense">
                </div>

                <!-- Client name -->
                <div class="fb-group">
                    <label for="client-name">CLIENTE</label>
                    <input class="fb-input" type="text" id="client-name" placeholder="ex. Empresa LTDA" required>
                </div>

                <!-- Host -->
                <div class="fb-group">
                    <label for="fw-host">IP FIREWALL</label>
                    <input class="fb-input" type="text" id="fw-host" placeholder="ex. 10.1.3.1" required>
                </div>

                <!-- Port (TLS switch removed) -->
                <div class="fb-group">
                    <label for="fw-port">PORTA</label>
                    <input class="fb-input" type="number" id="fw-port" min="1" max="65535" value="7070" required>
                </div>

                <!-- Recurrence -->
                <div class="fb-group">
                    <label>RECORRÊNCIA</label>
                    <div class="recurrence-segment" id="recurrence-segment" role="tablist" aria-label="Recurrence">
                        <button type="button" class="recurrence-option is-active" data-recurrence="daily" role="tab"
                            aria-selected="true">Diariamente</button>
                        <button type="button" class="recurrence-option" data-recurrence="weekly" role="tab"
                            aria-selected="false">Semanal</button>
                    </div>
                    <input type="hidden" id="recurrence" value="daily">
                </div>

                <div class="fb-group recurrence-weekly" id="recurrence-weekly" hidden>
                    <label>DIAS DA SEMANA</label>
                    <div class="weekday-chips" id="weekday-chips">
                        <button type="button" class="chip" data-day="mon">Seg</button>
                        <button type="button" class="chip" data-day="tue">Ter</button>
                        <button type="button" class="chip" data-day="wed">Qua</button>
                        <button type="button" class="chip" data-day="thu">Qui</button>
                        <button type="button" class="chip" data-day="fri">Sex</button>
                        <button type="button" class="chip" data-day="sat">Sáb</button>
                        <button type="button" class="chip" data-day="sun">Dom</button>
                    </div>
                </div>

                <div class="fb-group">
                    <label for="schedule-time">HORÁRIO</label>
                    <input class="fb-input" type="time" id="schedule-time" value="02:00">
                </div>

                <!-- OPNsense auth (API) + REQUIRED CA .PEM -->
                <div class="platform-section" data-for="opnsense">
                    <div class="fb-group">
                        <label for="api-key">API KEY</label>
                        <input class="fb-input" type="text" id="api-key" placeholder="OPNsense API key">
                    </div>
                    <div class="fb-group">
                        <label for="api-secret">API SECRET</label>
                        <div class="fb-input-with-btn">
                            <input class="fb-input" type="password" id="api-secret" placeholder="OPNsense API secret">
                            <button type="button" class="icon-button" id="toggle-secret" title="Show/Hide">
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                        </div>
                    </div>
                    <div class="fb-group">
                        <label for="tls-cert">CERTIFICADO CA (.PEM)</label>
                        <input class="fb-input" type="file" id="tls-cert" accept=".pem">
                        <div class="fb-hint">Envie a CA que assinou o certificado da WebGUI do OPNsense (.pem).
                            Obrigatório.</div>
                    </div>
                </div>

                <!-- pfSense auth (GUI user/pass) -->
                <div class="platform-section" data-for="pfsense" hidden>
                    <div class="fb-group">
                        <label for="fw-user">USUÁRIO</label>
                        <input class="fb-input" type="text" id="fw-user" placeholder="GUI user">
                    </div>
                    <div class="fb-group">
                        <label for="fw-pass">SENHA</label>
                        <div class="fb-input-with-btn">
                            <input class="fb-input" type="password" id="fw-pass" placeholder="GUI password">
                            <button type="button" class="icon-button" id="toggle-pass" title="Show/Hide">
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="fb-actions">
                    <button type="button" class="btn-link btn-ghost" data-close>
                        <span class="material-symbols-outlined">arrow_back</span> Cancel
                    </button>
                    <button type="submit" class="submit-button">
                        <span class="material-symbols-outlined" style="margin-right:8px;">save</span> Save
                    </button>
                </div>

                <div id="form-msg" class="form-msg" hidden></div>
            </form>
        </div>
    </div>
</div>

<script src="/static/JS/firewall-backup.js"></script>
{% endblock %}